from flask import Flask, render_template, json, request
import MySQLdb
app = Flask(__name__)

@app.route('/')
@app.route('/search')
def search_page():
    return render_template("search.html")

@app.route('/search', methods=['GET', 'POST'])
def input():
    conn=MySQLdb.connect(user="root", host="localhost", db="saleinf")
    cursor = conn.cursor()
    try:
        username = request.form['username']
        if username:
            cursor.execute('select id_user from users where user_name="{!s}"'.format(username))
            iduser = cursor.fetchone()
            if iduser:
                cursor.execute('select * from users, accounts, orders where users.id_user=accounts.id_user AND accounts.id_account=orders.id_account AND users.user_name= "{!s}"'.format(username))
                conn.commit()
                return render_template('search_result.html', users=cursor.fetchall())
            else:
                return "No users found"
        else:
            return "Please enter the required fields"

    finally:
      cursor.close()
      conn.close()


    

if __name__ == "__main__":
    app.run(debug=True, port=5000)
